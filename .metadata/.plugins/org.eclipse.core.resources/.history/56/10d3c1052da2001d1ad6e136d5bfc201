<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<%@ include file="../include/style.jsp"%>
<link href="resources/css/register.css" rel="stylesheet" type="text/css">
<head>
<meta charset="UTF-8">
<script src="https://kit.fontawesome.com/3f27d28028.js"
	crossorigin="anonymous"></script>
<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.3.1.min.js"></script>
<script>
	
	var idck = 0;

	$(document).ready(function() {

		//ë’¤ë¡œê°€ê¸° ë²„íŠ¼
		$("#goBack").click(function(e) {
			e.preventDefault();
			history.back();
		})
	
		// ì•„ì´ë”” ì¤‘ë³µì²´í¬
		$("#duplIdCheck").click(function(e) {
			e.preventDefault();
			duplIdCheck();
		})
		
		// íšŒì›ê°€ì… 
		$("#submitBtn").click(function(e) {
			e.preventDefault();
			signUp();
		})
		
	});
	
	// ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ ì—¬ë¶€ í™•ì¸
	$(function() {
		$("#pwdSuccess").hide();
		$("#pwdFail").hide();
		$("#rePwd").keyup(function() {
			var pwd = $("#pwd").val();
			var rePwd = $("#rePwd").val();
			if (rePwd == "") {
				$("#pwdSuccess").hide();
				$("#pwdFail").hide();
			} else if (pwd != "" || rePwd != "") {
				if (pwd == rePwd) {
					$("#pwdSuccess").show();
					$("#pwdFail").hide();
					$("#rePwd").removeClass("is-invalid")
					$("#submitBtn").removeAttr("disabled");
				} else {
					$("#pwdSuccess").hide();
					$("#pwdFail").show();
					$("#rePwd").addClass("is-invalid")
					$("#submitBtn").attr("disabled", "disabled");
				}
			}
		});
	});
	
	$(function() {
		$("#pwdSuccess").hide();
		$("#pwdFail").hide();
		$("#pwd").keyup(function() {
			var pwd = $("#pwd").val();
			var rePwd = $("#rePwd").val();
			if (rePwd == "") {
				$("#pwdSuccess").hide();
				$("#pwdFail").hide();
			} else if (pwd != "" || rePwd != "") {
				if (pwd == rePwd) {
					$("#pwdSuccess").show();
					$("#pwdFail").hide();
					$("#rePwd").removeClass("is-invalid")
					$("#submitBtn").removeAttr("disabled");
				} else {
					$("#pwdSuccess").hide();
					$("#pwdFail").show();
					$("#rePwd").addClass("is-invalid")
					$("#submitBtn").attr("disabled", "disabled");
				}
			}
		});
	});
	
	function duplIdCheck() {
		//ë¹„ë™ê¸° í†µì‹  ì„ ì–¸ (ajax)
		$.ajax({
			type : "GET",
			url : "/idDuplCheck",
			dataType : "json",
			data : {
				id : $('#id').val(),
			}, //ì „ì†¡í•  ë°ì´í„°
			success : function(data) {

				if (data.duplId == true) {
					alert('ì¤‘ë³µëœ ì•„ì´ë””ì…ë‹ˆë‹¤. ë‹¤ë¥¸ ì•„ì´ë””ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.');
				} else {
					alert('ì‚¬ìš©ê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤.');
					idck = 1;
				}
			},

		});

	};
	
	function signUp() {
		
		if (idck == 0) {
			
		} else {
			//ë¹„ë™ê¸° í†µì‹  ì„ ì–¸ (ajax)
			$.ajax({
				type : "GET",
				url : "/signUp",
				dataType : "json",
				data : {
					id : $('#id').val(),
					pwd : $('#pwd').val(),
					nickname : $('#nickname').val(),
				}, //ì „ì†¡í•  ë°ì´í„°
				success : function(data) {

					if (data.signUp == true) {
						alert('ğŸ‰ íšŒì›ê°€ì…ì— ì„±ê³µí•˜ì˜€ìŠµë‹ˆë‹¤! ğŸ‰');
					} else {
						alert('íšŒì›ê°€ì…ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤ğŸ˜­');
					}
				},

			});
		}
	};
</script>
</head>
<body>
	<form>
		<div class="container">
			<i class="fa-sharp fa-solid fa-arrow-left" id="goBack"></i>
			<h1 style="text-align: center">Sign Up</h1>
			<p style="text-align: center">Please fill in this form to create
				an account.</p>

			<label for="email"><b>ID *</b></label>
			<div id ="idInputDiv" style="display:flex">
			<input type="text"
				name="username" id = "id" placeholder="Enter User ID" required>
			<button type="button" class="btn btn-outline-primary" id="duplIdCheck">Check</button>
			</div>
			<label
			for="nickname"><b>Nickname *</b></label> 
			<input type="text" id="nickname"
			placeholder="Enter Nickname" name="nickname" required>
			<label
			for="psw"><b>Password *</b></label> 
			<input type="password" id="pwd"
			placeholder="Enter Password" name="pwd" required> 
			<label
			for="rePwd"><b>Re-enter Password *</b></label>
			 <input type="password" id="rePwd"
			placeholder="Re-Enter Password" name="rePwd" required>
			<span id="pwdFail" style="color:red;"><strong>ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</strong></span>
			<span id="pwdSuccess" style="color:blue;"><strong>ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤.</strong></span>
				 
			<button type="submit" class="submitBtn" id="submitBtn">Sign Up</button>
		</div>
	</form>
</body>
</html>